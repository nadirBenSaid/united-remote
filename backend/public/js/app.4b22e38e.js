(function(t){function e(e){for(var o,r,c=e[0],s=e[1],u=e[2],d=0,l=[];d<c.length;d++)r=c[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&l.push(a[r][0]),a[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=s[o]);p&&p(e);while(l.length)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,r=1;r<n.length;r++){var c=n[r];0!==a[c]&&(o=!1)}o&&(i.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},r={app:0},a={app:0},i=[];function c(t){return s.p+"js/"+({}[t]||t)+"."+{"chunk-6dc2acbc":"0973cd6b","chunk-e76c828c":"ba1fc914"}[t]+".js"}function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(t){var e=[],n={"chunk-6dc2acbc":1,"chunk-e76c828c":1};r[t]?e.push(r[t]):0!==r[t]&&n[t]&&e.push(r[t]=new Promise((function(e,n){for(var o="css/"+({}[t]||t)+"."+{"chunk-6dc2acbc":"4c47f88b","chunk-e76c828c":"bf1b34b6"}[t]+".css",a=s.p+o,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var u=i[c],d=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(d===o||d===a))return e()}var l=document.getElementsByTagName("style");for(c=0;c<l.length;c++){u=l[c],d=u.getAttribute("data-href");if(d===o||d===a)return e()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=e,p.onerror=function(e){var o=e&&e.target&&e.target.src||a,i=new Error("Loading CSS chunk "+t+" failed.\n("+o+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=o,delete r[t],p.parentNode.removeChild(p),n(i)},p.href=a;var h=document.getElementsByTagName("head")[0];h.appendChild(p)})).then((function(){r[t]=0})));var o=a[t];if(0!==o)if(o)e.push(o[2]);else{var i=new Promise((function(e,n){o=a[t]=[e,n]}));e.push(o[2]=i);var u,d=document.createElement("script");d.charset="utf-8",d.timeout=120,s.nc&&d.setAttribute("nonce",s.nc),d.src=c(t);var l=new Error;u=function(e){d.onerror=d.onload=null,clearTimeout(p);var n=a[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",l.name="ChunkLoadError",l.type=o,l.request=r,n[1](l)}a[t]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:d})}),12e4);d.onerror=d.onload=u,document.head.appendChild(d)}return Promise.all(e)},s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],d=u.push.bind(u);u.push=e,u=u.slice();for(var l=0;l<u.length;l++)e(u[l]);var p=d;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var o=n("85ec"),r=n.n(o);r.a},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("becf"),n("cabf"),n("3c76");var o=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Navigation"),n("router-view")],1)},a=[],i=n("3d20"),c=n.n(i),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.isLoggedIn?n("mdb-navbar",{directives:[{name:"show",rawName:"v-show",value:"regular-fixed"==t.navbarType,expression:"navbarType == 'regular-fixed'"}],attrs:{position:"top",light:"",color:"cloudy-knoxville-gradient",scrolling:""}},[n("mdb-navbar-brand",[t._v("Shoppy")]),n("mdb-navbar-toggler",[n("mdb-navbar-nav",[n("mdb-nav-item",{attrs:{id:"root",to:"/",active:"",darkWaves:""}},[t._v("Nearby Shops")]),n("mdb-nav-item",{attrs:{id:"liked",to:"/liked",darkWaves:""}},[t._v("Liked Shops")])],1),n("mdb-navbar-nav",{attrs:{right:""}},[n("a",{on:{click:function(e){return t.logout()}}},[n("mdb-nav-item",{attrs:{darkWaves:""}},[t._v("Logout")])],1)])],1)],1):t._e()],1)},u=[],d=(n("a4d3"),n("4de4"),n("4160"),n("1d1c"),n("7a82"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("2fa7")),l=n("91c9"),p=n("2f62");function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(d["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={name:"Navigation",components:{mdbNavbar:l["mdbNavbar"],mdbNavItem:l["mdbNavItem"],mdbNavbarNav:l["mdbNavbarNav"],mdbNavbarBrand:l["mdbNavbarBrand"],mdbNavbarToggler:l["mdbNavbarToggler"],mdbInput:l["mdbInput"],mdbBtn:l["mdbBtn"]},data:function(){return{navbarType:"regular-fixed",content:!1}},computed:f({},Object(p["c"])(["isLoggedIn"])),methods:f({},Object(p["b"])(["logout"]))},b=m,v=n("2877"),g=Object(v["a"])(b,s,u,!1,null,null,null),y=g.exports,k={name:"App",components:{Navigation:y},created:function(){localStorage.getItem("token")||c.a.fire({title:"Welcome!",text:"We invite you to signup or login in order to experience the website",icon:"info"})}},S=k,O=(n("034f"),Object(v["a"])(S,r,a,!1,null,null,null)),w=O.exports,j=(n("45fc"),n("d3b7"),n("8c4f")),C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("ShopsLayout")],1)},_=[],x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mdb-container",[n("transition-group",{attrs:{name:"list"}},t._l(t.allShops,(function(t){return n("shop-card",{key:t._id,attrs:{shop:t}})})),1),t.totalCount!=t.allShops.length?n("section",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:function(e,n){return t.visibilityChanged(e,n,t.fetchShops)},expression:"\n\t\t\t\t(isVisible, entry) =>\n\t\t\t\t\tvisibilityChanged(isVisible, entry, fetchShops)\n\t\t\t"}]},[n("div",{staticClass:"justify-content-center"},[n("div",{staticClass:"spinner-border",attrs:{role:"status"}},[n("span",{staticClass:"sr-only"},[t._v("Loading...")])])])]):t._e()],1)},P=[],I=n("d827"),E=n("85fe");function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){Object(d["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var N={name:"ShopsLayout",directives:{ObserveVisibility:E["a"]},components:{mdbContainer:l["mdbContainer"],ShopCard:I["a"]},methods:L({},Object(p["b"])(["fetchShops","getLocation"]),{visibilityChanged:function(t,e,n){t&&n()}}),mounted:function(){this.getLocation()},computed:Object(p["c"])(["allShops","totalCount"])},A=N,B=(n("ca36"),Object(v["a"])(A,x,P,!1,null,"b944cf2e",null)),D=B.exports,z={name:"home",components:{ShopsLayout:D}},W=z,R=(n("6a29"),Object(v["a"])(W,C,_,!1,null,"7c456faf",null)),$=R.exports,q=(n("99af"),n("caad"),n("d81d"),n("b0c0"),n("2532"),n("96cf"),n("284c")),H=n("bc3a"),M=n.n(H),V=function(){return{shops:[],likedShops:[],totalCount:0,fetchedCount:0,hiddenCount:0,fetchRounds:0,location:"",token:localStorage.getItem("token")||"",likedShopsIds:[],dislikedShopsIds:[]}},U=V(),G={isLoggedIn:function(t){return!!t.token},getToken:function(t){return t.token},getLikedIds:function(t){return t.likedShopsIds},getDislikedIds:function(t){return t.dislikedShopsIds},location:function(t){return t.location},allShops:function(t){return t.shops},totalCount:function(t){return t.totalCount},getHidden:function(t){return t.hiddenCount},getLikedShops:function(t){return t.likedShops}},J={signup:function(t,e){var n=t.commit;e.email&&e.password&&e.name&&M.a.post("".concat("http://localhost:3000","/api/v1/users"),{email:e.email,password:e.password,name:e.name}).then((function(t){return n("setToken",t.data)}))["catch"]((function(t){400==t.response.status?c.a.fire("Try again!","Invalid data format.","error"):409==t.response.status&&c.a.fire("Try again!","Email already exists.","error")}))},login:function(t,e){var n=t.commit;e.email&&e.password&&M.a.post("".concat("http://localhost:3000","/api/v1/users/login"),{email:e.email,password:e.password}).then((function(t){return n("setToken",t.data)}))["catch"]((function(t){c.a.fire("Try again!","Wrong email or password","error")}))},getLocation:function(t){var e=t.commit;navigator.geolocation.getCurrentPosition((function(t){e("setLocation",t.coords.longitude+","+t.coords.latitude),0==U.fetchedCount&&J.fetchShops({commit:e})}),(function(t){0==U.totalCount&&(c.a.fire({title:"We can't get your location",text:"User's location is defaulted to center of Rabat, If you're using the remote version of the website, we can't get your position without HTTPS due to browser policies",icon:"warning",confirmButtonText:"Okay"}),0==U.fetchedCount&&J.fetchShops({commit:e}))}))},fetchShops:function(t){var e=t.commit;J.fetchUserShops().then((function(t){return e("setShops",t.data)}))["catch"]((function(t){return c.a.fire("Error","Something wrong happened and we can't seem to retrieve the shops","error")}));var n=U.location?"&location=".concat(U.location):"";M.a.get("".concat("http://localhost:3000","/api/v1/shops?skip=").concat(16*U.fetchRounds,"&limit=16").concat(n)).then((function(t){t.data.docs=t.data.docs.filter((function(t){return![].concat(Object(q["a"])(U.likedShopsIds),Object(q["a"])(U.dislikedShopsIds)).includes(t._id)||(e("updateHidden"),!1)})),e("setShopsAndCount",t.data)}))["catch"]((function(t){return c.a.fire("Error","Something wrong happened and we can't seem to retrieve your shops","error")}))},fetchUserShops:function(){return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return M.a.defaults.headers.common["Authorization"]=U.token,t.next=3,regeneratorRuntime.awrap(M.a.get("".concat("http://localhost:3000","/api/v1/users/shops")));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}))},logout:function(t){var e=t.commit;localStorage.removeItem("token"),delete M.a.defaults.headers.common["Authorization"],e("logout")},likeShop:function(t,e){var n=t.commit;M.a.defaults.headers.common["Authorization"]=U.token,M.a.put("".concat("http://localhost:3000","/api/v1/users/shops/").concat(e),{like:!0}).then((function(t){n("filterShops",e),n("setShops",t.data),n("updateHidden")}))["catch"]((function(t){return c.a.fire("Error","Something wrong happened and we can't seem to like the shop","error")}))},dislikeShop:function(t,e){var n=t.commit;M.a.defaults.headers.common["Authorization"]=U.token,M.a.put("".concat("http://localhost:3000","/api/v1/users/shops/").concat(e),{dislike:!0}).then((function(t){n("updateHidden"),n("filterShops",e),n("setShops",t.data)}))["catch"]((function(t){return c.a.fire("Error","Something wrong happened and we can't seem to dislike this shop","error")}))},fetchLikedShops:function(t){var e=t.commit;M.a.defaults.headers.common["Authorization"]=U.token,M.a.get("".concat("http://localhost:3000","/api/v1/users/shops?likes=true")).then((function(t){return e("setLikedShops",t.data)}))["catch"]((function(t){return c.a.fire("Error","Something wrong happened and we can't seem to retrieve your shops","error")}))},removeShop:function(t,e){var n=t.commit;M.a.defaults.headers.common["Authorization"]=U.token,M.a.put("".concat("http://localhost:3000","/api/v1/users/shops/").concat(e),{remove:!0}).then((function(t){J.fetchLikedShops({commit:n}),n("removeShop",e)}))["catch"]((function(t){return c.a.fire("Error","Something wrong happened and we can't seem to remove this shop","error")}))}},F={setToken:function(t,e){console.log(e),t.token="Bearer "+e,localStorage.setItem("token",t.token),Z.push("/")},setLocation:function(t,e){t.location=e},setShops:function(t,e){t.likedShopsIds=e.likes,t.dislikedShopsIds=e.dislikes.map((function(t){return t._id}))},setShopsAndCount:function(t,e){t.shops=[].concat(Object(q["a"])(t.shops),Object(q["a"])(e.docs)),t.fetchedCount=e.totalCount,t.totalCount=t.fetchedCount+t.hiddenCount,t.fetchRounds+=1},logout:function(t){Object.assign(t,V()),Z.push("/auth")},updateHidden:function(t){t.shops.length+t.likedShopsIds.length+t.dislikedShopsIds.length==t.fetchedCount?t.totalCount-=1:t.hiddenCount-=1},filterShops:function(t,e){return t.shops=t.shops.filter((function(t){return t._id!=e}))},setLikedShops:function(t,e){return t.likedShops=e},removeShop:function(t,e){t.shops=[],t.hiddenCount=0,t.fetchRounds=0,t.fetchedCount=0,t.likedShops=t.likedShops.filter((function(t){return e!=t}))}},K={state:U,getters:G,actions:J,mutations:F};o["default"].use(p["a"]);var Y=new p["a"].Store({modules:{shops:K}});o["default"].use(j["a"]);var Q=[{path:"/",name:"home",component:$,meta:{requiresAuth:!0}},{path:"/liked",name:"liked",component:function(){return n.e("chunk-6dc2acbc").then(n.bind(null,"e1eb"))},meta:{requiresAuth:!0}},{path:"/auth",name:"auth",component:function(){return n.e("chunk-e76c828c").then(n.bind(null,"2fef"))},meta:{requiresNotAuth:!0}}],X=new j["a"]({routes:Q});X.beforeEach((function(t,e,n){if(t.matched.some((function(t){return t.meta.requiresAuth}))){if(Y.getters.isLoggedIn)return void n();n("/auth")}else if(t.matched.some((function(t){return t.meta.requiresNotAuth}))){if(!Y.getters.isLoggedIn)return void n();n("/")}else n()}));var Z=X;o["default"].config.productionTip=!1,new o["default"]({router:Z,store:Y,render:function(t){return t(w)}}).$mount("#app")},"6a29":function(t,e,n){"use strict";var o=n("9d06"),r=n.n(o);r.a},"85ec":function(t,e,n){},"9d06":function(t,e,n){},ca36:function(t,e,n){"use strict";var o=n("d2e8"),r=n.n(o);r.a},d2e8:function(t,e,n){},d827:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mdb-col",{attrs:{lg:"3"}},[n("mdb-card",{staticClass:"animated"},[n("mdb-view",{attrs:{hover:""}},[n("mdb-card-image",{attrs:{src:t.shop.picture}}),n("mdb-mask",{attrs:{"flex-center":"",waves:"",overlay:"white-slight"}})],1),n("mdb-card-body",{staticStyle:{"background-color":"rgb(247, 247, 247)"}},[n("mdb-card-title",[t._v(t._s(t.shop.name))]),n("mdb-card-text",[t._v("City: "+t._s(t.shop.city))]),"/"==t.$route.path?n("div",[n("mdb-btn",{attrs:{gradient:"cloudy-knoxville",size:"md",darkWaves:""},on:{click:function(e){return t.dislikeShop(t.shop._id)}}},[n("mdb-icon",{staticClass:"deep-orange-text",staticStyle:{"font-size":"15px"},attrs:{icon:"thumbs-down"}})],1),n("mdb-btn",{attrs:{gradient:"cloudy-knoxville",size:"md",darkWaves:""},on:{click:function(e){return t.likeShop(t.shop._id)}}},[n("mdb-icon",{staticClass:"light-green-text",staticStyle:{"font-size":"15px"},attrs:{icon:"thumbs-up"}})],1)],1):t._e(),"/liked"==t.$route.path?n("mdb-btn-group",[n("mdb-btn",{attrs:{gradient:"cloudy-knoxville",size:"md",darkWaves:""},on:{click:function(e){return t.initRemove(t.shop._id,t.removeShop)}}},[n("mdb-icon",{staticClass:"blue-grey-text",staticStyle:{"font-size":"15px"},attrs:{icon:"trash"}})],1)],1):t._e()],1)],1),n("br")],1)},r=[],a=(n("a4d3"),n("4de4"),n("4160"),n("1d1c"),n("7a82"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("2fa7")),i=n("91c9"),c=n("2f62"),s=n("3d20"),u=n.n(s);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(a["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var p={name:"ShopCard",props:{shop:Object},components:{mdbCol:i["mdbCol"],mdbCard:i["mdbCard"],mdbCardImage:i["mdbCardImage"],mdbCardBody:i["mdbCardBody"],mdbCardTitle:i["mdbCardTitle"],mdbCardText:i["mdbCardText"],mdbBtnGroup:i["mdbBtnGroup"],mdbBtn:i["mdbBtn"],mdbView:i["mdbView"],mdbIcon:i["mdbIcon"],mdbMask:i["mdbMask"]},methods:l({},Object(c["b"])(["likeShop","dislikeShop","removeShop"]),{initRemove:function(t,e){u.a.fire({title:"Are you sure you want to remove this shop from your likes?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#607d8b",cancelButtonColor:"#d33",confirmButtonText:"Yes, remove it!"}).then((function(n){n.value&&e(t)}))}})},h=p,f=n("2877"),m=Object(f["a"])(h,o,r,!1,null,null,null);e["a"]=m.exports}});
//# sourceMappingURL=app.4b22e38e.js.map