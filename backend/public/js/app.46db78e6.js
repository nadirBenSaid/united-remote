(function(e){function t(t){for(var o,r,c=t[0],s=t[1],u=t[2],d=0,l=[];d<c.length;d++)r=c[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&l.push(a[r][0]),a[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);p&&p(t);while(l.length)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,r=1;r<n.length;r++){var c=n[r];0!==a[c]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},a={app:0},i=[];function c(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-23e7538a":"edff504f","chunk-549a0ed4":"668bc13b"}[e]+".js"}function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={"chunk-23e7538a":1,"chunk-549a0ed4":1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=new Promise((function(t,n){for(var o="css/"+({}[e]||e)+"."+{"chunk-23e7538a":"c627c1dc","chunk-549a0ed4":"fb39850e"}[e]+".css",a=s.p+o,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var u=i[c],d=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(d===o||d===a))return t()}var l=document.getElementsByTagName("style");for(c=0;c<l.length;c++){u=l[c],d=u.getAttribute("data-href");if(d===o||d===a)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var o=t&&t.target&&t.target.src||a,i=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=o,delete r[e],p.parentNode.removeChild(p),n(i)},p.href=a;var h=document.getElementsByTagName("head")[0];h.appendChild(p)})).then((function(){r[e]=0})));var o=a[e];if(0!==o)if(o)t.push(o[2]);else{var i=new Promise((function(t,n){o=a[e]=[t,n]}));t.push(o[2]=i);var u,d=document.createElement("script");d.charset="utf-8",d.timeout=120,s.nc&&d.setAttribute("nonce",s.nc),d.src=c(e);var l=new Error;u=function(t){d.onerror=d.onload=null,clearTimeout(p);var n=a[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",l.name="ChunkLoadError",l.type=o,l.request=r,n[1](l)}a[e]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:d})}),12e4);d.onerror=d.onload=u,document.head.appendChild(d)}return Promise.all(t)},s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],d=u.push.bind(u);u.push=t,u=u.slice();for(var l=0;l<u.length;l++)t(u[l]);var p=d;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var o=n("85ec"),r=n.n(o);r.a},"0ab7":function(e,t,n){"use strict";var o=n("3c71"),r=n.n(o);r.a},"24d8":function(e,t,n){"use strict";var o=n("387d"),r=n.n(o);r.a},"387d":function(e,t,n){},"3c71":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("becf"),n("cabf"),n("3c76");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},a=[],i=n("3d20"),c=n.n(i),s={name:"App",created:function(){localStorage.getItem("token")||c.a.fire("Welcome!","Please start by either signing up or signing in to experience the website","info")}},u=s,d=(n("034f"),n("2877")),l=Object(d["a"])(u,r,a,!1,null,null,null),p=l.exports,h=(n("45fc"),n("d3b7"),n("8c4f")),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Navbar"),n("div",{staticClass:"home"},[n("ShopsLayout")],1)],1)},m=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("mdb-container",[e._l(this.chunk(e.allShops,4),(function(t,o){return n("div",{key:o},[n("mdb-row",e._l(t,(function(e){return n("shop-card",{key:e._id,attrs:{shop:e}})})),1),n("br")],1)})),e.totalCount!=e.allShops.length?n("section",[n("div",{staticClass:"justify-content-center"},[n("div",{staticClass:"spinner-border",attrs:{role:"status"}},[n("span",{staticClass:"sr-only"},[e._v("Loading...")])])])]):e._e()],2)},g=[],v=(n("a4d3"),n("4de4"),n("4160"),n("a630"),n("fb6a"),n("1d1c"),n("7a82"),n("e439"),n("dbb4"),n("b64b"),n("3ca3"),n("159b"),n("2fa7")),k=n("d827"),y=n("91c9"),S=n("f7fe"),O=n.n(S),w=n("2f62");function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){Object(v["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _={name:"ShopsLayout",components:{mdbContainer:y["mdbContainer"],mdbRow:y["mdbRow"],ShopCard:k["a"]},methods:C({},Object(w["b"])(["fetchShops","getLocation"]),{chunk:function(e,t){return Array.from({length:Math.ceil(e.length/t)},(function(n,o){return e.slice(o*t,o*t+t)}))},scroll:function(){var e=this;window.onscroll=O()((function(){var t=document.documentElement,n=Math.ceil(t.scrollTop+window.innerHeight),o=t.offsetHeight-7;n>=o&&e.allShops.length<e.totalCount&&"/"==e.$route.path&&e.fetchShops({skip:16*e.getSkip,limit:16})}),500)}}),mounted:function(){this.getLocation(),this.scroll()},computed:Object(w["c"])(["allShops","totalCount","getSkip"])},P=_,E=(n("0ab7"),Object(d["a"])(P,b,g,!1,null,"6e819d57",null)),x=E.exports,I=n("d178"),T={name:"home",components:{ShopsLayout:x,Navbar:I["a"]}},L=T,A=(n("fdf0"),Object(d["a"])(L,f,m,!1,null,"66a92828",null)),N=A.exports,B=(n("99af"),n("caad"),n("a15b"),n("d81d"),n("b0c0"),n("4fad"),n("2532"),n("284c")),D=n("e587"),R=n("bc3a"),z=n.n(R),$=function(){return{shops:[],likedShops:[],totalCount:0,fetchedCount:0,hiddenCount:0,fetchRounds:0,location:"",token:localStorage.getItem("token")||"",likedShopsIds:[],dislikedShopsIds:[]}},H=$(),M={isLoggedIn:function(e){return!!e.token},getToken:function(e){return e.token},getLikedIds:function(e){return e.likedShopsIds},getDislikedIds:function(e){return e.dislikedShopsIds},location:function(e){return e.location},allShops:function(e){return e.shops},totalCount:function(e){return e.totalCount},getHidden:function(e){return e.hiddenCount},getSkip:function(e){return e.fetchRounds},getLikedShops:function(e){return e.likedShops}},q={signup:function(e,t){var n=e.commit;t.email&&t.password&&t.name&&z.a.post("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users"),{email:t.email,password:t.password,name:t.name}).then((function(e){return n("setToken",e.data)}))["catch"]((function(e){c.a.fire("Try again!","The data you entered is invalid","error")}))},login:function(e,t){var n=e.commit;t.email&&t.password&&z.a.post("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users/login"),{email:t.email,password:t.password}).then((function(e){return n("setToken",e.data)}))["catch"]((function(e){c.a.fire("Try again!","Wrong email or password","error")}))},getLocation:function(e){var t=e.commit;navigator.geolocation.getCurrentPosition((function(e){t("setLocation",e.coords.longitude+","+e.coords.latitude),0==H.fetchedCount&&q.fetchShops({commit:t},{skip:0,limit:16})}),(function(e){0==H.totalCount&&c.a.fire({title:"We can't get your location",text:"User's location is defaulted to center of Rabat, we don't save your location info so maybe change your mind?",icon:"info",confirmButtonText:"I'll think about it..."}),0==H.fetchedCount&&q.fetchShops({commit:t},{skip:0,limit:16})}))},fetchShops:function(e,t){var n=e.commit;q.fetchUserShops({commit:n});var o=Object.entries(t).map((function(e){var t=Object(D["a"])(e,2),n=t[0],o=t[1];return"".concat(n,"=").concat(o)})).join("&");o+=H.location?"&location=".concat(H.location):"",z.a.get("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/shops?").concat(o)).then((function(e){e.data.docs=e.data.docs.filter((function(e){return![].concat(Object(B["a"])(H.likedShopsIds),Object(B["a"])(H.dislikedShopsIds)).includes(e._id)||(n("updateHidden"),!1)})),n("setShopsAndCount",e.data)}))["catch"]((function(e){return c.a.fire("Error","Something wrong happened and we can't seem to retrieve your shops","error")}))},fetchUserShops:function(e){var t=e.commit;z.a.defaults.headers.common["Authorization"]=H.token,z.a.get("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users/shops")).then((function(e){return t("setShops",e.data)}))["catch"]((function(e){return c.a.fire("Error","Something wrong happened and we can't seem to retrieve the shops","error")}))},logout:function(e){var t=e.commit;localStorage.removeItem("token"),delete z.a.defaults.headers.common["Authorization"],t("logout")},likeShop:function(e,t){var n=e.commit;z.a.defaults.headers.common["Authorization"]=H.token,z.a.put("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users/shops/").concat(t),{up:!0}).then((function(e){n("filterShops",t),n("setShops",e.data),n("updateHidden")}))["catch"]((function(e){return c.a.fire("Error","Something wrong happened and we can't seem to like the shop","error")}))},dislikeShop:function(e,t){var n=e.commit;z.a.defaults.headers.common["Authorization"]=H.token,z.a.put("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users/shops/").concat(t),{up:!1}).then((function(e){n("updateHidden"),n("filterShops",t),n("setShops",e.data)}))["catch"]((function(e){return c.a.fire("Error","Something wrong happened and we can't seem to dislike this shop","error")}))},fetchLikedShops:function(e){var t=e.commit;z.a.defaults.headers.common["Authorization"]=H.token,z.a.get("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users/shops?likes=true")).then((function(e){return t("setLikedShops",e.data)}))["catch"]((function(e){return c.a.fire("Error","Something wrong happened and we can't seem to retrieve your shops","error")}))},removeShop:function(e,t){var n=e.commit;z.a.defaults.headers.common["Authorization"]=H.token,z.a.put("".concat("http://ur-coding-challenge.apps.us-east-1.starter.openshift-online.com","/api/v1/users/shops/").concat(t),{up:!1}).then((function(e){q.fetchLikedShops({commit:n}),n("removeShop",t)}))["catch"]((function(e){return c.a.fire("Error","Something wrong happened and we can't seem to remove this shop","error")}))}},U={setToken:function(e,t){e.token="Bearer "+t,localStorage.setItem("token",e.token),F.push("/")},setLocation:function(e,t){e.location=t},setShops:function(e,t){e.likedShopsIds=t.likes,e.dislikedShopsIds=t.dislikes.map((function(e){return e._id}))},setShopsAndCount:function(e,t){e.shops=[].concat(Object(B["a"])(e.shops),Object(B["a"])(t.docs)),e.fetchedCount=t.totalCount,e.totalCount=e.fetchedCount+e.hiddenCount,e.fetchRounds+=1},logout:function(e){Object.assign(e,$()),F.push("/auth")},updateHidden:function(e){e.shops.length+e.likedShopsIds.length+e.dislikedShopsIds.length==e.fetchedCount?e.totalCount-=1:e.hiddenCount-=1},filterShops:function(e,t){return e.shops=e.shops.filter((function(e){return e._id!=t}))},setLikedShops:function(e,t){return e.likedShops=t},removeShop:function(e,t){e.shops=[],e.hiddenCount=0,e.fetchRounds=0,e.fetchedCount=0,e.likedShops=e.likedShops.filter((function(e){return t!=e}))}},W={state:H,getters:M,actions:q,mutations:U};o["default"].use(w["a"]);var G=new w["a"].Store({modules:{shops:W}});o["default"].use(h["a"]);var J=[{path:"/",name:"home",component:N,meta:{requiresAuth:!0}},{path:"/liked",name:"liked",component:function(){return n.e("chunk-23e7538a").then(n.bind(null,"e1eb"))},meta:{requiresAuth:!0}},{path:"/auth",name:"auth",component:function(){return n.e("chunk-549a0ed4").then(n.bind(null,"2fef"))},meta:{requiresNotAuth:!0}}],V=new h["a"]({routes:J});V.beforeEach((function(e,t,n){if(e.matched.some((function(e){return e.meta.requiresAuth}))){if(G.getters.isLoggedIn)return void n();n("/auth")}else if(e.matched.some((function(e){return e.meta.requiresNotAuth}))){if(!G.getters.isLoggedIn)return void n();n("/")}else n()}));var F=V;o["default"].config.productionTip=!1,new o["default"]({router:F,store:G,render:function(e){return e(p)}}).$mount("#app")},"85ec":function(e,t,n){},d178:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("mdb-navbar",{directives:[{name:"show",rawName:"v-show",value:"regular-fixed"==e.navbarType,expression:"navbarType == 'regular-fixed'"}],attrs:{position:"top",dark:"",color:"primary",scrolling:""}},[n("mdb-navbar-toggler",[n("mdb-navbar-nav",[n("router-link",{attrs:{to:{name:"home"}}},[n("mdb-nav-item",{attrs:{"waves-fixed":""}},[e._v("Nearby Shops")])],1),n("router-link",{attrs:{to:{name:"liked"}}},[n("mdb-nav-item",{attrs:{"waves-fixed":""}},[e._v("Liked Shops")])],1)],1),n("mdb-navbar-nav",{attrs:{right:""}},[n("a",{on:{click:function(t){return e.logout()}}},[n("mdb-nav-item",{attrs:{"waves-fixed":""}},[e._v("Logout")])],1)])],1)],1)],1)},r=[],a=(n("a4d3"),n("4de4"),n("4160"),n("1d1c"),n("7a82"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("2fa7")),i=n("91c9"),c=n("2f62");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={name:"NavigationPage",components:{mdbNavbar:i["mdbNavbar"],mdbNavItem:i["mdbNavItem"],mdbNavbarNav:i["mdbNavbarNav"],mdbNavbarToggler:i["mdbNavbarToggler"],mdbInput:i["mdbInput"],mdbBtn:i["mdbBtn"]},data:function(){return{navbarType:"regular-fixed",content:!1}},methods:u({},Object(c["b"])(["logout"]))},l=d,p=(n("24d8"),n("2877")),h=Object(p["a"])(l,o,r,!1,null,"7dc4ffac",null);t["a"]=h.exports},d827:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("mdb-col",{attrs:{lg:"3"}},[n("mdb-card",[n("mdb-view",{attrs:{hover:""}},[n("mdb-card-image",{attrs:{src:e.shop.picture}}),n("mdb-mask",{attrs:{"flex-center":"",waves:"",overlay:"white-slight"}})],1),n("mdb-card-body",[n("mdb-card-title",[e._v(e._s(e.shop.name))]),n("mdb-card-text",[e._v("City: "+e._s(e.shop.city))]),"/"==e.$route.path?n("mdb-btn-group",[n("mdb-btn",{attrs:{color:"success",size:"sm",icon:"thumbs-up"},on:{click:function(t){return e.likeShop(e.shop._id)}}}),n("mdb-btn",{attrs:{color:"danger",size:"sm",icon:"thumbs-down"},on:{click:function(t){return e.dislikeShop(e.shop._id)}}})],1):e._e(),"/liked"==e.$route.path?n("mdb-btn-group",[n("mdb-btn",{attrs:{color:"primary",size:"sm",icon:"trash"},on:{click:function(t){return e.initRemove(e.shop._id,e.removeShop)}}},[e._v("Remove")])],1):e._e()],1)],1)],1)},r=[],a=(n("a4d3"),n("4de4"),n("4160"),n("1d1c"),n("7a82"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("2fa7")),i=n("91c9"),c=n("2f62"),s=n("3d20"),u=n.n(s);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={name:"ShopCard",props:{shop:Object},components:{mdbCol:i["mdbCol"],mdbCard:i["mdbCard"],mdbCardImage:i["mdbCardImage"],mdbCardBody:i["mdbCardBody"],mdbCardTitle:i["mdbCardTitle"],mdbCardText:i["mdbCardText"],mdbBtnGroup:i["mdbBtnGroup"],mdbBtn:i["mdbBtn"],mdbView:i["mdbView"],mdbMask:i["mdbMask"]},methods:l({},Object(c["b"])(["likeShop","dislikeShop","removeShop"]),{initRemove:function(e,t){u.a.fire({title:"Are you sure you want to remove this shop?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, remove it!"}).then((function(n){t(e)}))}})},h=p,f=n("2877"),m=Object(f["a"])(h,o,r,!1,null,null,null);t["a"]=m.exports},f29f:function(e,t,n){},fdf0:function(e,t,n){"use strict";var o=n("f29f"),r=n.n(o);r.a}});
//# sourceMappingURL=app.46db78e6.js.map